<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dino</title>
</head>
<body onload="startGame()">
<canvas id="canvas" width="480" height="270" style="border: 1px solid #000000"></canvas>
<div style="text-align:center;width:480px;">
    <button onkeydown="dino.Jump()" onkeyup="movedown()" >JUMP</button><br><br>
</div>
</body>
<script>
    let dino;
    let mobj = [];
    let sobj = [];
    function startGame() {
        dino = new Component( 30, 40, 'dino', 20, 230, 'image');
        gameArea.start();
    }
    let gameArea ={
        canvas: document.getElementById("canvas"),
        start: function () {
            this.canvas.width = 480;
            this.canvas.height = 270;
            this.context = this.canvas.getContext("2d");
            this.frame = 0;
            this.interval = setInterval(updateGameArea, 20);
            // document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            // window.addEventListener('keydown', function (e) {
            //     myGameArea.keys = (myGameArea.keys || []);
            //     myGameArea.keys[e.keyCode] = true;
            // });
            // window.addEventListener('keyup', function (e) {
            //     myGameArea.keys[e.keyCode] = false;
            // });
        },
        clear : function() {
            this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        },
        stop : function() {
            clearInterval(this.interval);
        }
    }
    // if (dino.speedY + dino.y < 150) {
    //     check = true;
    // }
    let Component = function (width, height, color, x, y, type) {
      this.type = type;
      if (type == 'image'&& color == 'dino') {
          this.image = new Image();
      }
      this.width = width;
      this.height = height;
      this.speedY = 0;
      this.x = x;
      this.y = y;
      this.draw = function () {
          ctx = gameArea.context;
          if (type == 'image') {
              if (gameArea.frame % 2 == 0) {
                  console.log('1')
                  color = 'dinorun1.png'
              }
              if (gameArea.frame % 2 != 0) {
                  console.log('2')
                  color = 'dinorun2.png'
              }
              this.image.src = color;

              ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
          } else {
              ctx.fillStyle = color;
              ctx.fillRect(this.x, this.y, this.width, this.height);
          }
      }
      this.newPos = function () {
          this.y += this.speedY;
          this.hitBottom();
          this.hitUp();
      }
      this.hitBottom = function () {
          if (this.speedY + this.y > 270 - this.height ) {
              this.speedY = 0;
          }
      }
      this.hitUp = function () {
          if (this.speedY + this.y < 130) {
              this.speedY = 5
          }
      }
      this.Jump = function () {
          if (this.speedY <= 0) {
              moveup();
          }
      }
      // this.run = function () {
      //     if (myGameArea.keys && myGameArea.keys[32]) {
      //         dino.Jump();
      //     }
      // }
      this.crashWith = function (obj) {
          let myleft = this.x + 5;
          let myright = this.x + (this.width) - 5;
          let mytop = this.y;
          let mybottom = this.y + (this.height) - 7;
          let otherleft = obj.x;
          let otherright = obj.x + (obj.width);
          let othertop = obj.y;
          let otherbottom = obj.y + (obj.height);
          let crash = true;
          if ((mybottom < othertop) || (mytop > otherbottom) || (myright < otherleft) || (myleft > otherright)) {
              crash = false;
          }
          return crash;
        }
    }
    // let dino;
    // let Choke = function() {
    //     this.width = width;
    //     this.height = height;
    //     this.color = color;
    //     this.x = x;
    //     this.y = y;
    //     this.draw = function () {
    //         ctx = myGameArea.context;
    //         ctx.fillStyle = this.color;
    //         ctx.fillRect(this.x, this.y, this.width, this.height);
    //     }
    // }
    let updateGameArea = function () {
        // if (gameArea.frame % 2 === 0) {
        //     //dino = new Component( 30, 40, 'dinorun1.png', 20, 230, 'image');
        // } else {
        //     //dino = new Component( 30, 40, 'dinorun2.png', 20, 230, 'image');
        // }
        let x, y;
        for (let i = 0; i < mobj.length; i++) {
            if (dino.crashWith(mobj[i])) {
                gameArea.stop();
                alert('You lose')
                return;
            }
        }
        gameArea.clear();
        gameArea.frame += 1;
        if (gameArea.frame === 1 || ninterval(50)) {
            let n = Math.floor(Math.random() * 5 + 0)
            for (let i = 0; i < n; i++) {
                x = gameArea.canvas.width;
                height = Math.floor(Math.random() * 50) + 10;
                y = gameArea.canvas.height - height;
                mobj.push(new Component(10, height, "green", x + i * 10, y));

            }
        }
        for (let i = 0; i < mobj.length; i++) {
            mobj[i].x += -5;
            mobj[i].draw();
        }
        if (gameArea.frame === 1 || ninterval(50)) {
            x = 0;
            y = gameArea.canvas.height - 15;
            sobj.push(new Component(x, y, 'ground', 1200, 15));
        }
        for (let i = 0; i < sobj.length; i++) {
            sobj[i].x += -2;
            sobj[i].draw();
        }
        dino.newPos();
        dino.draw();
    }

    let ninterval = function(n) {
        if ((gameArea.frame / n) % 1 === 0) {
            return true;
        }
            return false;
    }
    function moveup() {
        dino.speedY = -5;
    }
    function movedown() {
        dino.speedY = 5;
    }


</script>
</html>